// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
/*
 * Copyright (c) 2024 Rockchip Electronics Co., Ltd.
 */

/dts-v1/;
// from rk3506b-evb1-v10
#include <dt-bindings/display/drm_mipi_dsi.h>
#include <dt-bindings/suspend/rockchip-rk3506.h>
#include <dt-bindings/input/rk-input.h>
#include "rk3506.dtsi"
// #include "rk3506-armsom-forge1-display.dtsi"
#include "rk3506-armsom-forge1-display-8hd.dtsi"

/ {
	model = "Rockchip RK3506J(BGA) ArmSoM Forge1";
	compatible = "rockchip,rk3506J-armsom-forge1", "rockchip,rk3506";

    chosen {
		bootargs = "earlycon=uart8250,mmio32,0xff0a0000 console=tty1 console=ttyFIQ0 root=/dev/mmcblk0p3 rootfstype=ext4 rootwait snd_aloop.index=7 snd_aloop.use_raw_jiffies=1";
	};

    vcc12v_dc: vcc12v-dc {
		compatible = "regulator-fixed";
		regulator-name = "vcc12v_dc";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <12000000>;
		regulator-max-microvolt = <12000000>;
	};

	vcc5v0_sys: vcc5v0-sys {
		compatible = "regulator-fixed";
		regulator-name = "vcc5v0_sys";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		vin-supply = <&vcc12v_dc>;
	};

	vcc_3v3: vcc-3v3 {
		compatible = "regulator-fixed";
		regulator-name = "vcc_3v3";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		vin-supply = <&vcc5v0_sys>;
	};

	vcc_1v8: vcc-1v8 {
		compatible = "regulator-fixed";
		regulator-name = "vcc_1v8";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <1800000>;
		regulator-max-microvolt = <1800000>;
		vin-supply = <&vcc5v0_sys>;
	};

	vcc_ddr: vcc-ddr {
		compatible = "regulator-fixed";
		regulator-name = "vcc_ddr";
		regulator-always-on;
		regulator-boot-on;
		vin-supply = <&vcc5v0_sys>;
	};

	vdd_arm: vdd-arm {
		compatible = "pwm-regulator";
		pwms = <&pwm0_4ch_0 0 5000 1>;
		regulator-name = "vdd_arm";
		regulator-min-microvolt = <710000>;
		regulator-max-microvolt = <1207000>;
		regulator-init-microvolt = <1011000>;
		regulator-always-on;
		regulator-boot-on;
		regulator-settling-time-up-us = <250>;
		pwm-supply = <&vcc5v0_sys>;
	};

    dd_0v9: vdd-0v9 {
		compatible = "regulator-fixed";
		regulator-name = "vdd_0v9";
		regulator-always-on;
		regulator-boot-on;
		regulator-min-microvolt = <900000>;
		regulator-max-microvolt = <900000>;
		vin-supply = <&vcc5v0_sys>;
	};

	vcc3v3_lcd_n: vcc3v3-lcd0-n {
		status = "okay";
		compatible = "regulator-fixed";
		regulator-name = "vcc3v3_lcd_n";
		regulator-boot-on;
		regulator-min-microvolt = <3300000>;
		regulator-max-microvolt = <3300000>;
		regulator-always-on;
		enable-active-high;
		gpio = <&gpio0 RK_PA1 GPIO_ACTIVE_HIGH>;
		vin-supply = <&vcc_3v3>;
	};
	vcc5v0_otg1: vcc5v0-otg1-regulator {
		compatible = "regulator-fixed";
		regulator-name = "vcc5v0_otg1";
		regulator-boot-on;
		regulator-always-on;
		regulator-min-microvolt = <5000000>;
		regulator-max-microvolt = <5000000>;
		enable-active-high;
		gpio = <&gpio1 RK_PD0 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&vcc5v0_otg1_en>;
	};

	fiq_debugger: fiq-debugger {
		compatible = "rockchip,fiq-debugger";
		rockchip,serial-id = <0>;
		rockchip,wake-irq = <0>;
		rockchip,irq-mode-enable = <1>;
		rockchip,baudrate = <1500000>;	/* Only 115200 and 1500000 */
		interrupts = <GIC_SPI 115 IRQ_TYPE_LEVEL_HIGH>;
	};

	rk730_sound: rk730-sound {
		status = "okay";
		compatible = "rockchip,multicodecs-card";
		rockchip,card-name = "rockchip-rk730";
		spk-con-gpio = <&gpio1 RK_PC6 GPIO_ACTIVE_HIGH>;
		hp-det-gpio = <&gpio0 RK_PD0 GPIO_ACTIVE_HIGH>;
		pinctrl-names = "default";
		pinctrl-0 = <&hp_det_pin>;
		rockchip,pre-power-on-delay-ms = <30>;
		rockchip,post-power-down-delay-ms = <40>;
		rockchip,format = "i2s";
		rockchip,mclk-fs = <512>;
		rockchip,cpu = <&sai1>;
		rockchip,codec = <&rk730>;
		rockchip,audio-routing =
			"Headphone", "LOUT1",
			"Headphone", "ROUT1",
			"Speaker", "LOUT2",
			"Speaker", "ROUT2",
			"Headphone", "Headphone Power",
			"Headphone", "Headphone Power",
			"Speaker", "Speaker Power",
			"Speaker", "Speaker Power",
			"MIC2", "Main Mic",
			"MIC1", "Main Mic";
	};

	leds {
		compatible = "gpio-leds";
		pinctrl-name = "default";
		pinctrl-0 = <&work_led>;

		green-led {
			default-state = "on";
			gpios = <&gpio4 RK_PB3 GPIO_ACTIVE_HIGH>;
			label = "rockchip:work_led:system";
			linux,default-trigger = "heartbeat";
		};
	};
};

&can0 {
	assigned-clocks = <&cru CLK_CAN0>;
	assigned-clock-rates = <300000000>;
	pinctrl-0 = <&rm_io19_can0_tx &rm_io20_can0_rx>;
	pinctrl-names = "default";
	status = "okay";
};

&cma {
	size = <0x1600000>;
};

&cpu0 {
 cpu-supply = <&vdd_arm>;
};

&fspi {
	status = "okay";

	flash@0 {
		compatible = "spi-nand";
		reg = <0>;
		spi-max-frequency = <80000000>;
		spi-rx-bus-width = <4>;
		spi-tx-bus-width = <1>;
	};
};

&gmac0 {
	phy-mode = "rmii";
	clock_in_out = "output";

	snps,reset-gpio = <&gpio0 RK_PC2 GPIO_ACTIVE_LOW>;
	snps,reset-active-low;
	snps,reset-delays-us = <0 20000 100000>;

	pinctrl-names = "default";
	pinctrl-0 = <&eth_rmii0_miim_pins
		     &eth_rmii0_tx_bus2_pins
		     &eth_rmii0_rx_bus2_pins
		     &eth_rmii0_clk_pins>;

	phy-handle = <&rmii_phy0>;
	status = "okay";
};

&gmac1 {
	phy-mode = "rmii";
	clock_in_out = "output";

	snps,reset-gpio = <&gpio1 RK_PC7 GPIO_ACTIVE_LOW>;
	snps,reset-active-low;
	snps,reset-delays-us = <0 20000 100000>;

	pinctrl-names = "default";
	pinctrl-0 = <&eth_rmii1_miim_pins
		     &eth_rmii1_tx_bus2_pins
		     &eth_rmii1_rx_bus2_pins
		     &eth_rmii1_clk_pins>;

	phy-handle = <&rmii_phy1>;
	status = "okay";
};

&mmc {
	no-sdio;
	no-mmc;
	pinctrl-names = "default";
	pinctrl-0 = <&sdmmc_bus4_pins &sdmmc_clk_pins &sdmmc_cmd_pins &sd_det>;
	cd-gpios = <&gpio0 RK_PA3 GPIO_ACTIVE_LOW>;
	// cd-debounce-delay-ms = <5>;
	disable-wp;
	vmmc-supply = <&vcc_3v3>;
	vqmmc-supply = <&vcc_3v3>;
	status = "okay";
};

&pinctrl {
    ethernet {
		rmii0_rstn: rmii0-rstn {
			rockchip,pins = <0 RK_PB7 RK_FUNC_GPIO &pcfg_pull_none>;
		};

		rmii1_rstn: rmii1-rstn {
			rockchip,pins = <0 RK_PC0 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	sdcard {
		sd_det: sd-det {
			rockchip,pins = <0 RK_PA3 RK_FUNC_GPIO &pcfg_pull_up>;
		};
	};

	usb {
		vcc5v0_otg1_en: vcc5v0-otg1-en {
			rockchip,pins = <1 RK_PD0 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	rk730 {
		hp_det_pin: hp-det-pin {
			rockchip,pins = <0 RK_PD0 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};

	led {
		work_led: work-led {
			rockchip,pins = <0 RK_PB5 RK_FUNC_GPIO &pcfg_pull_none>;
		};
	};
};

&rga2 {
	status = "okay";
};

&rng {
	status = "okay";
};

&rockchip_suspend {
	rockchip,sleep-mode-config = <
		(0
		| RKPM_ARMOFF_DDRPD
		| RKPM_24M_OSC_DIS
		| RKPM_32K_CLK
		| RKPM_32K_SRC_RC
		| RKPM_PWM0_CH0_REGULATOR
		)
	>;

	rockchip,apios-suspend = <
		(0
		| RKPM_PWREN_CORE_GPIO0A2 | RKPM_PWREN_CORE_ACT_LOW
		| RKPM_PWREN_SLEEP_GPIO0A0 | RKPM_PWREN_SLEEP_ACT_LOW
		)
	>;

#define GPIO0_IOC_GPIO0A_PULL_REG	0xff950200
#define GPIO0_IOC_GPIO0B_PULL_REG	0xff950204
#define GPIO0_IOC_GPIO0C_PULL_REG	0xff950208
#define GPIO0A3_PULL_DOWN		0x00c00080
#define GPIO0B0_PULL_DOWN		0x00030002
#define GPIO0C5_PULL_DOWN		0x0c000800

	/* Note: support max 16 pairs */
	rockchip,sleep-io-config = <
		GPIO0_IOC_GPIO0C_PULL_REG GPIO0C5_PULL_DOWN /* PWM0_CH0_CPU */
		GPIO0_IOC_GPIO0A_PULL_REG GPIO0A3_PULL_DOWN /* PWM0_CH2_LCD_BL */
		GPIO0_IOC_GPIO0B_PULL_REG GPIO0B0_PULL_DOWN /* SAI1_MCLK */
	>;
};


&sai1 {
    pinctrl-names = "default", "sleep";
	pinctrl-0 = <&rm_io9_sai1_sclk
		     &rm_io10_sai1_lrck
		     &rm_io11_sai1_sdi
		     &rm_io12_sai1_sdo0>;
	pinctrl-1 = <&rm_io9_idle_pins
		     &rm_io10_idle_pins
		     &rm_io11_idle_pins
		     &rm_io12_idle_pins>;
	status = "okay";
};

&i2c1 {
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&rm_io16_i2c1_scl &rm_io17_i2c1_sda>;

	rk730: rk730@17 {
		#sound-dai-cells = <0>;
		compatible = "rockchip,rk730";
		reg = <0x17>;
		clocks = <&mclkout_sai1>;
		clock-names = "mclk";
		assigned-clocks = <&mclkout_sai1>;
		assigned-clock-rates = <12288000>;
		pinctrl-names = "default";
		pinctrl-0 = <&rm_io8_sai1_mclk>;
		status = "okay";
	};
};

&i2c2{
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&rm_io4_i2c2_scl &rm_io5_i2c2_sda>;

	hym8563: hym8563@51 {
		compatible = "haoyu,hym8563";
		reg = <0x51>;
	};
};

&mdio0 {
	rmii_phy0: phy@1 {
		compatible = "ethernet-phy-ieee802.3-c22";
		reg = <0x1>;
	};
};

&mdio1 {
	rmii_phy1: phy@1 {
		compatible = "ethernet-phy-ieee802.3-c22";
		reg = <0x1>;
	};
};

&saradc {
	vref-supply = <&vcc_1v8>;
	status = "okay";
};

&tsadc {
	status = "okay";
};

&uart3 {
	pinctrl-names = "default";
	pinctrl-0 = <&rm_io14_uart3_tx &rm_io15_uart3_rx>;
	linux,rs485-enabled-at-boot-time;
	status = "okay";
};

&usb20_otg0 {
	status = "okay";
};

&u2phy_otg1 {
    phy-supply = <&vcc5v0_otg1>;
	status = "okay";
};

&usb2phy {
	status = "okay";
};

&usb20_otg1 {
	dr_mode = "host";
	status = "okay";
};
